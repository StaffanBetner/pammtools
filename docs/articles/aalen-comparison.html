<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vignette Title â€¢ pamm</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">pamm</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/aalen-comparison.html">Vignette Title</a>
    </li>
    <li>
      <a href="../articles/baseline.html">Baseline Hazard</a>
    </li>
    <li>
      <a href="../articles/basics.html">Basic Modeling </a>
    </li>
    <li>
      <a href="../articles/convenience.html">Convenience functions for post-processing PAMs</a>
    </li>
    <li>
      <a href="../articles/data-transformation.html">Data Transformation</a>
    </li>
    <li>
      <a href="../articles/frailty.html">Frailty and random effects</a>
    </li>
    <li>
      <a href="../articles/model-evaluation.html">Model evaluation</a>
    </li>
    <li>
      <a href="../articles/splines.html">Splines</a>
    </li>
    <li>
      <a href="../articles/strata.html">Stratified baseline</a>
    </li>
    <li>
      <a href="../articles/tdcovar.html">Time-dependent covariates</a>
    </li>
    <li>
      <a href="../articles/tveffects.html">Time-varying effects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/adibender/pamm">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Vignette Title</h1>
                        <h4 class="author">Vignette Author</h4>
            
            <h4 class="date">2017-09-14</h4>
          </div>

    
    
<div class="contents">
<div id="comparison-to-estimation-of-time-dependent-covariates-from-aalen-model" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-to-estimation-of-time-dependent-covariates-from-aalen-model" class="anchor"></a>Comparison to estimation of time-dependent covariates from Aalen Model</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## load libraries
<span class="kw">library</span>(pamm)
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(tidyr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(mgcv)

## load original data
liver &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">"leber.Rds"</span>) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/dplyr_verbs.html">mutate</a></span>(<span class="dt">Geschlecht =</span> <span class="kw">factor</span>(Geschlecht, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"m"</span>, <span class="st">"f"</span>)))

## transform to piece-wise exponential data (PED)
ped &lt;-<span class="st"> </span><span class="kw"><a href="../reference/split_data.html">split_data</a></span>(<span class="kw">Surv</span>(days, Todjanein)~Geschlecht +<span class="st"> </span>Alter.bei.OP, <span class="dt">data=</span>liver, <span class="dt">id=</span><span class="st">"id"</span>)
<span class="kw">head</span>(ped)
## estimate baseline
mbase &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mgcv/topics/gam">gam</a></span>(ped_status ~<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mgcv/topics/s">s</a></span>(intmid), <span class="dt">data=</span>ped, <span class="dt">family=</span>poisson, <span class="dt">offset=</span>offset)
<span class="kw">summary</span>(mbase)
<span class="kw">plot</span>(mbase, <span class="dt">page=</span><span class="dv">1</span>, <span class="dt">rug=</span><span class="ot">FALSE</span>)

## estimate baseline by sex
msex &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mgcv/topics/gam">gam</a></span>(ped_status ~<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mgcv/topics/s">s</a></span>(intmid, <span class="dt">by=</span>Geschlecht), <span class="dt">data=</span>ped, <span class="dt">family=</span><span class="kw">poisson</span>(),
    <span class="dt">offset =</span> offset)
<span class="kw">plot</span>(msex, <span class="dt">page=</span><span class="dv">1</span>, <span class="dt">rug=</span><span class="ot">FALSE</span>)

## plot hazards
pinfo &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ped_info.html">ped_info</a></span>(ped)
pinfo &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(pinfo, <span class="kw"><a href="../reference/dplyr_verbs.html">mutate</a></span>(pinfo, <span class="dt">Geschlecht =</span> <span class="kw">factor</span>(<span class="st">"f"</span>, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">"f"</span>, <span class="st">"m"</span>))))
pinfo %&lt;&gt;%<span class="st"> </span><span class="kw"><a href="../reference/add_hazard.html">add_hazard</a></span>(msex) %&gt;%<span class="st"> </span><span class="kw"><a href="../reference/dplyr_verbs.html">mutate</a></span>(<span class="dt">hazard =</span> <span class="kw">as.numeric</span>(hazard))

<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(pinfo, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>intmid, <span class="dt">y =</span> hazard)) +
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_ribbon">geom_ribbon</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">ymin=</span>lower, <span class="dt">ymax=</span>upper, <span class="dt">fill=</span>Geschlecht), <span class="dt">alpha=</span><span class="fl">0.2</span>) +
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">col=</span>Geschlecht))

## calculate cumulative difference between Geschlecht = 1 and Geschlecht = 0
pinf2 &lt;-<span class="st"> </span>pinfo %&gt;%<span class="st"> </span><span class="kw"><a href="../reference/dplyr_verbs.html">select</a></span>(tend, intlen, Geschlecht, hazard, lower, upper) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/dplyr_verbs.html">group_by</a></span>(Geschlecht) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/dplyr_verbs.html">mutate</a></span>(
        <span class="dt">hazard =</span> <span class="kw">cumsum</span>(hazard *<span class="st"> </span>intlen),
        <span class="dt">lower =</span> <span class="kw">cumsum</span>(lower*intlen),
        <span class="dt">upper =</span> <span class="kw">cumsum</span>(upper*intlen)) %&gt;%
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/gather">gather</a></span>(type, haz, hazard:upper) %&gt;%
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/spread">spread</a></span>(Geschlecht, haz) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/dplyr_verbs.html">mutate</a></span>(<span class="dt">cumudiff =</span> f -<span class="st"> </span>m) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/dplyr_verbs.html">select</a></span>(tend, type, cumudiff) %&gt;%
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/spread">spread</a></span>(type, cumudiff)

gg.betasex &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(pinf2, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>tend)) +
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_step</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">y=</span>hazard)) +
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/lims">ylim</a></span>(<span class="kw">c</span>(-<span class="fl">0.4</span>, <span class="fl">0.5</span>))
gg.betasex

##  comparison to aalen model
<span class="kw">library</span>(timereg)
fit5 &lt;-<span class="kw"><a href="http://www.rdocumentation.org/packages/timereg/topics/aalen">aalen</a></span>(<span class="kw">Surv</span>(days, Todjanein)~Geschlecht,<span class="dt">data=</span>liver, <span class="dt">resample.iid=</span><span class="dv">1</span>)
<span class="kw">plot</span>(fit5)
<span class="kw">lines</span>(pinf2$tend, pinf2$hazard, <span class="dt">col=</span><span class="dv">2</span>, <span class="dt">type=</span><span class="st">"s"</span>)</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#comparison-to-estimation-of-time-dependent-covariates-from-aalen-model">Comparison to estimation of time-dependent covariates from Aalen Model</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Andreas Bender, Fabian Scheipl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
