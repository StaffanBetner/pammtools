<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Convenience functions for post-processing PAMs • pammtools</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Convenience functions for post-processing PAMs">
<meta property="og:description" content="">
<meta property="og:image" content="https://adibender.github.io/pammtools/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-44545040-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-44545040-3');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pammtools</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/baseline.html">Baseline Hazard</a>
    </li>
    <li>
      <a href="../articles/basics.html">Basic Modeling </a>
    </li>
    <li>
      <a href="../articles/convenience.html">Convenience functions for post-processing PAMs</a>
    </li>
    <li>
      <a href="../articles/data-transformation.html">Data Transformation</a>
    </li>
    <li>
      <a href="../articles/frailty.html">Frailty and random effects</a>
    </li>
    <li>
      <a href="../articles/splines.html">Splines</a>
    </li>
    <li>
      <a href="../articles/strata.html">Stratified baseline</a>
    </li>
    <li>
      <a href="../articles/tdcovar.html">Time-dependent covariates</a>
    </li>
    <li>
      <a href="../articles/tveffects.html">Time-varying effects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/adibender/pammtools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Convenience functions for post-processing PAMs</h1>
                        <h4 class="author">Andreas Bender</h4>
            
            <h4 class="date">2018-06-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/adibender/pammtools/blob/master/vignettes/convenience.Rmd"><code>vignettes/convenience.Rmd</code></a></small>
      <div class="hidden name"><code>convenience.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(mgcv)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(pammtools)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme_get">theme_set</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>())</a></code></pre></div>
<div id="convenience-functions" class="section level1">
<h1 class="hasAnchor">
<a href="#convenience-functions" class="anchor"></a>Convenience functions</h1>
<p>Survival analysis entails a set of standard tasks beyond model estimation which need to be performed in most real world applications. These task include:</p>
<ul>
<li>summary/visualization of estimated effects</li>
<li>extraction/visualization of the estimated baseline hazard</li>
<li>extraction/visualization of the predicted (cumulative) hazards or survival probabilities for specific covariate specifications</li>
<li>comparison of the predicted (cumulative) hazards or survival probabilities for a set of covariate specifications</li>
<li>comparison of the predicted (cumulative) hazards or survival probabilities and estimated effects resulting from different model specifications or different subsets of the data.</li>
</ul>
<p>This package contains some convenience functions to achieve these tasks. The overall philosophy of the package was to provide functions that return the underlying data used for visualization in a <em>tidy</em> format <span class="citation">(Wickham and others 2014)</span>, such that everybody can use familiar tools for further processing. In addition, some convenience functions for visualization are also included.</p>
<p>We use the <code>mgus2</code> data <span class="citation">(Kyle 1993)</span> from the <code>survival</code> package for illustration in the following.</p>
<div id="summaryvisualization-of-fixed-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#summaryvisualization-of-fixed-effects" class="anchor"></a>Summary/visualization of fixed effects</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">data</span>(<span class="st">"mgus2"</span>, <span class="dt">package =</span> <span class="st">"survival"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">ped &lt;-<span class="st"> </span>mgus2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/as_ped.html">as_ped</a></span>(<span class="kw">Surv</span>(futime, death)<span class="op">~</span>age <span class="op">+</span><span class="st"> </span>hgb <span class="op">+</span><span class="st"> </span>sex, <span class="dt">id =</span> <span class="st">"id"</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">pam &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mgcv/topics/gam">gam</a></span>(ped_status <span class="op">~</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mgcv/topics/s">s</a></span>(tend) <span class="op">+</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mgcv/topics/s">s</a></span>(hgb), <span class="dt">data =</span> ped,</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="dt">family =</span> <span class="kw">poisson</span>(), <span class="dt">offset =</span> offset)</a></code></pre></div>
<p>The easiest way to obtain an overview of the estimated coefficients for fixed effects is to simply call <code>summary</code> on the fitted model object:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">summary</span>(pam)</a></code></pre></div>
<pre><code>## 
## Family: poisson 
## Link function: log 
## 
## Formula:
## ped_status ~ s(tend) + sex + age + s(hgb)
## 
## Parametric coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -9.133845   0.256891 -35.555  &lt; 2e-16 ***
## sexM         0.472157   0.068539   6.889 5.62e-12 ***
## age          0.055019   0.003398  16.191  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##           edf Ref.df Chi.sq  p-value    
## s(tend) 7.525  8.428  88.12 2.89e-15 ***
## s(hgb)  3.384  4.256  87.47  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  0.0055   Deviance explained = 5.55%
## UBRE = -0.92892  Scale est. = 1         n = 123848</code></pre>
<p>However, we also provide a convenience function that extracts a fixed coefficient table from <code><a href="http://www.rdocumentation.org/packages/mgcv/topics/gam">mgcv::gam</a></code> objects (including confidence intervals) and a convenience function that creates a forrest-type plot:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="../reference/tidy_fixed.html">tidy_fixed</a></span>(pam) <span class="co"># per default intercept is ommitted</span></a></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   variable   coef ci_lower ci_upper
##   &lt;chr&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 sexM     0.472    0.335    0.609 
## 2 age      0.0550   0.0482   0.0618</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../reference/gg_fixed.html">gg_fixed</a></span>(pam)</a></code></pre></div>
<p><img src="convenience_files/figure-html/unnamed-chunk-4-1.png" width="288" style="display: block; margin: auto;"></p>
<p>We can see that the estimated mortality risk for male subjects is increased by a factor of about <span class="math inline">\(\exp(0.47) = 1.6\)</span> compared to female subjects.</p>
<!--
Additionally, this package provides a function to visualize fixed coefficients
in terms of tree/forest plots:


```r
## yet to be implemented
```
-->
</div>
<div id="summaryvisualization-of-smooth-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#summaryvisualization-of-smooth-effects" class="anchor"></a>Summary/visualization of smooth effects</h2>
<p>A first quick overview over the smooth effects is provided in the bottom part of output of the <code>summary</code> call above. The interpretation is the same as as for <code><a href="http://www.rdocumentation.org/packages/mgcv/topics/gam">mgcv::gam</a></code> objects (see <code><a href="http://www.rdocumentation.org/packages/mgcv/topics/summary.gam">?summary.gam</a></code> for details). Briefly, the <code>edf</code> column provides the number of effective degrees of freedom used to fit the spline (values larger than 1 indicate non-linearity) and the p-value refers to a significance test against the null hypothesis of “no effect” (i.e., <span class="math inline">\(H_0: f_j(x_j) = 0\)</span>; test developed in <span class="citation">Wood (2013)</span>).</p>
<p>Usually, however, we want to visualize the non-linear effect by plotting <span class="math inline">\(f_j(x_j)\)</span> over the range of <span class="math inline">\(x_j\)</span> values. One possibility using base R plotting functions is to call the default plot function for <code><a href="http://www.rdocumentation.org/packages/mgcv/topics/gam">mgcv::gam</a></code> objects. Note that PAM effects are additive on the log-hazard scale, so we have to plot <span class="math inline">\(\exp(f_j(x_j))\)</span> (right panel below) in order to read hazard <em>ratios</em> off the figure:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">## extract smooths plot data</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">shgb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/tidiers.html">tidy_smooth</a></span>(pam) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/dplyr_verbs.html">filter</a></span>(xlab<span class="op">==</span><span class="st">"hgb"</span>)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">## create plots for hgb effect</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">hgb_ggp &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(shgb, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>x)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">y=</span>fit)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_ribbon">geom_ribbon</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">ymin=</span>ci_lower, <span class="dt">ymax=</span>ci_upper), <span class="dt">alpha=</span><span class="fl">0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"f(hgb)"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"hgb"</span>)</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">hgb_ggp_log &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(shgb, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>x)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">y=</span><span class="kw">exp</span>(fit))) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_ribbon">geom_ribbon</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">ymin=</span><span class="kw">exp</span>(ci_lower), <span class="dt">ymax=</span><span class="kw">exp</span>(ci_upper)), <span class="dt">alpha=</span><span class="fl">0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"exp(f(hgb))"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"hgb"</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/coord_trans">coord_trans</a></span>(<span class="dt">y=</span><span class="st">"log"</span>)</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">## combine into one graph</a>
<a class="sourceLine" id="cb8-14" data-line-number="14"> gridExtra<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(hgb_ggp, hgb_ggp_log, <span class="dt">nrow =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="convenience_files/figure-html/unnamed-chunk-6-1.png" width="768" style="display: block; margin: auto;"></p>
<p>If you want to customize the figure using other graphics packages you can extract the data used for plotting via:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">hgb.term &lt;-<span class="st"> </span>ped <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/get_terms.html">get_terms</a></span>(<span class="dt">fit =</span> pam, <span class="dt">terms =</span> <span class="st">"hgb"</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw">head</span>(hgb.term)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   term      x   eff    se ci_lower ci_upper
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 hgb    5.70  1.34 0.337    0.669     2.02
## 2 hgb    5.83  1.32 0.320    0.678     1.96
## 3 hgb    5.97  1.29 0.304    0.685     1.90
## 4 hgb    6.10  1.27 0.288    0.692     1.84
## 5 hgb    6.23  1.24 0.273    0.697     1.79
## 6 hgb    6.37  1.22 0.258    0.702     1.73</code></pre>
<p>For convenience we also include a function that plots multiple selected smooth effects in one figure<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">ped <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/gg_smooth.html">gg_smooth</a></span>(pam, <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">"tend"</span>, <span class="st">"hgb"</span>))</a></code></pre></div>
<p><img src="convenience_files/figure-html/unnamed-chunk-8-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div id="extractionvisualization-of-the-baseline-hazard" class="section level2">
<h2 class="hasAnchor">
<a href="#extractionvisualization-of-the-baseline-hazard" class="anchor"></a>Extraction/Visualization of the baseline hazard</h2>
<p>In PAMs the baseline hazard <span class="math inline">\(\lambda_0(t)\)</span> is estimated semi-parametrically as a (potentially) non-linear smoothed step function. Thus the model specification usually looks like</p>
<p><span class="math display">\[
\log(\lambda(t|x)) = \beta_0 + f_0(t) + \ldots
\]</span></p>
<p>Thus the term <span class="math inline">\(f_0(t)\)</span> represents the time-varying part of the log-baseline-hazard.</p>
<p>To create a data set with all interval cut-points we can use the function <code>ped_info</code> applied to an object of class <code>ped</code> (<strong>p</strong>iece-wise <strong>e</strong>xponential <strong>d</strong>ata). In addition to information about each interval, the data set returned by the function contains mean values of continuous variables and the modal values of categorical variables.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">ped_df  &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ped_info.html">ped_info</a></span>(ped)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw">head</span>(ped_df)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 8
##   tstart  tend intlen intmid interval   age   hgb sex  
##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;
## 1     0.    1.     1.  0.500 (0,1]     70.4  13.3 M    
## 2     1.    2.     1.  1.50  (1,2]     70.4  13.3 M    
## 3     2.    3.     1.  2.50  (2,3]     70.4  13.3 M    
## 4     3.    4.     1.  3.50  (3,4]     70.4  13.3 M    
## 5     4.    5.     1.  4.50  (4,5]     70.4  13.3 M    
## 6     5.    6.     1.  5.50  (5,6]     70.4  13.3 M</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">tail</span>(ped_df)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 8
##   tstart  tend intlen intmid interval    age   hgb sex  
##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;
## 1   282.  287.     5.   284. (282,287]  70.4  13.3 M    
## 2   287.  314.    27.   300. (287,314]  70.4  13.3 M    
## 3   314.  315.     1.   314. (314,315]  70.4  13.3 M    
## 4   315.  321.     6.   318. (315,321]  70.4  13.3 M    
## 5   321.  356.    35.   338. (321,356]  70.4  13.3 M    
## 6   356.  424.    68.   390. (356,424]  70.4  13.3 M</code></pre>
<p>This data set can be used to conveniently obtain the hazard, cumulative hazard and survival functions evaluated at the joint mean (and mode) of the covariates for all time points in the data:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">ped_df &lt;-<span class="st"> </span>ped_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/add_hazard.html">add_hazard</a></span>(pam)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">ped_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/dplyr_verbs.html">select</a></span>(interval, hazard, ci_lower, ci_upper) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   interval  hazard ci_lower ci_upper
##   &lt;fct&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 (0,1]    0.0111   0.00901   0.0137
## 2 (1,2]    0.0108   0.00880   0.0132
## 3 (2,3]    0.0104   0.00859   0.0127
## 4 (3,4]    0.0101   0.00838   0.0122
## 5 (4,5]    0.00981  0.00818   0.0118
## 6 (5,6]    0.00951  0.00797   0.0113</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">ped_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/dplyr_verbs.html">select</a></span>(interval, hazard, ci_lower, ci_upper) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tail</span>()</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   interval  hazard ci_lower ci_upper
##   &lt;fct&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 (282,287] 0.0203  0.0113    0.0364
## 2 (287,314] 0.0197  0.00927   0.0418
## 3 (314,315] 0.0197  0.00918   0.0420
## 4 (315,321] 0.0195  0.00869   0.0439
## 5 (321,356] 0.0195  0.00699   0.0546
## 6 (356,424] 0.0220  0.00312   0.156</code></pre>
<p>Which in turn can be conveniently plotted using respective functions, e.g.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(ped_df, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> tend)) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_step</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">y =</span> hazard)) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/geom_stepribbon.html">geom_stepribbon</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">ymin =</span> ci_lower, <span class="dt">ymax =</span> ci_upper), <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="kw">expression</span>(<span class="kw">hat</span>(lambda)(t))) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="kw">expression</span>(t))</a></code></pre></div>
<p><img src="convenience_files/figure-html/unnamed-chunk-11-1.png" width="384" style="display: block; margin: auto;"></p>
<p>or the cumulative hazard</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">gg.chaz &lt;-<span class="st"> </span>ped_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/add_hazard.html">add_cumu_hazard</a></span>(pam) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> tend, <span class="dt">y =</span> cumu_hazard, <span class="dt">ymin =</span> cumu_lower, <span class="dt">ymax =</span> cumu_upper))</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">gg.chaz <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_ribbon">geom_ribbon</a></span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="kw">expression</span>(<span class="kw">hat</span>(Lambda)(t))) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="kw">expression</span>(t))</a></code></pre></div>
<p><img src="convenience_files/figure-html/unnamed-chunk-12-1.png" width="384" style="display: block; margin: auto;"></p>
<p>or the survival probabilities</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">gg.surv &lt;-<span class="st"> </span>ped_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/add_surv_prob.html">add_surv_prob</a></span>(pam) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> tend, <span class="dt">y =</span> surv_prob, <span class="dt">ymax =</span> surv_lower, <span class="dt">ymin =</span> surv_upper))</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">gg.surv <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_ribbon">geom_ribbon</a></span>(<span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="kw">expression</span>(<span class="kw">hat</span>(S)(t))) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="kw">expression</span>(t))</a></code></pre></div>
<p><img src="convenience_files/figure-html/unnamed-chunk-13-1.png" width="384" style="display: block; margin: auto;"></p>
<p>This approach is very convenient, as the usual tidy <code>dplyr</code> workflow can be maintained throughout, for example, if we wanted to plot the cumulative hazard for different sexes:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">pinfo.sex &lt;-<span class="st"> </span>ped <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/dplyr_verbs.html">group_by</a></span>(sex) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/ped_info.html">ped_info</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/add_hazard.html">add_cumu_hazard</a></span>(pam)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw">head</span>(pinfo.sex)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 11
## # Groups:   sex [1]
##   tstart  tend intlen intmid interval   age   hgb sex   cumu_hazard
##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;       &lt;dbl&gt;
## 1     0.    1.     1.  0.500 (0,1]     71.3  12.8 F         0.00812
## 2     1.    2.     1.  1.50  (1,2]     71.3  12.8 F         0.0160 
## 3     2.    3.     1.  2.50  (2,3]     71.3  12.8 F         0.0236 
## 4     3.    4.     1.  3.50  (3,4]     71.3  12.8 F         0.0310 
## 5     4.    5.     1.  4.50  (4,5]     71.3  12.8 F         0.0382 
## 6     5.    6.     1.  5.50  (5,6]     71.3  12.8 F         0.0451 
## # ... with 2 more variables: cumu_lower &lt;dbl&gt;, cumu_upper &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">table</span>(pinfo.sex<span class="op">$</span>sex)</a></code></pre></div>
<pre><code>## 
##   F   M 
## 218 218</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(pinfo.sex, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> tend, <span class="dt">y =</span> cumu_hazard)) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_ribbon">geom_ribbon</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">ymin =</span> cumu_lower, <span class="dt">ymax =</span> cumu_upper, <span class="dt">fill =</span> sex), <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">col =</span> sex)) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_brewer">scale_color_brewer</a></span>(<span class="dt">palette =</span> <span class="st">"Set1"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_brewer">scale_fill_brewer</a></span>(<span class="dt">palette =</span> <span class="st">"Set1"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="kw">expression</span>(<span class="kw">hat</span>(Lambda)(t))) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="kw">expression</span>(t))</a></code></pre></div>
<p><img src="convenience_files/figure-html/unnamed-chunk-14-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-kyle1993">
<p>Kyle, Robert A. 1993. “"Benign" Monoclonal Gammopathy – After 20 to 35 Years of Follow-up.” In <em>Mayo Clinic Proceedings</em>, 68:26–36. 1.</p>
</div>
<div id="ref-wickham2014">
<p>Wickham, Hadley, and others. 2014. “Tidy Data.” <em>Journal of Statistical Software</em> 59 (10):1–23.</p>
</div>
<div id="ref-wood2013">
<p>Wood, Simon N. 2013. “On P-Values for Smooth Components of an Extended Generalized Additive Model.” <em>Biometrika</em> 100 (1):221–28.</p>
</div>
</div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Note that graphical representation of the baseline hazard is a slight approximation here – it should be a <em>step function</em>, since the baseline is piecewise constant over the intervals, cf. the baseline hazard function plotted correctly below.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#convenience-functions">Convenience functions</a><ul class="nav nav-pills nav-stacked">
<li><a href="#summaryvisualization-of-fixed-effects">Summary/visualization of fixed effects</a></li>
      <li><a href="#summaryvisualization-of-smooth-effects">Summary/visualization of smooth effects</a></li>
      <li><a href="#extractionvisualization-of-the-baseline-hazard">Extraction/Visualization of the baseline hazard</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Andreas Bender, Fabian Scheipl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script>
  docsearch({
    
    
    apiKey: 'c3726dcbf089f0b26f496305ed030c22',
    indexName: 'pammtools',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
