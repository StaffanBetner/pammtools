<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit a piece-wise exponential additive model — pamm • pamm</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">pamm</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/aalen-comparison.html">Vignette Title</a>
    </li>
    <li>
      <a href="../articles/baseline.html">Baseline Hazard</a>
    </li>
    <li>
      <a href="../articles/basics.html">Basic Modeling </a>
    </li>
    <li>
      <a href="../articles/convenience.html">Convenience functions for post-processing PAMs</a>
    </li>
    <li>
      <a href="../articles/data-transformation.html">Data Transformation</a>
    </li>
    <li>
      <a href="../articles/frailty.html">Frailty and random effects</a>
    </li>
    <li>
      <a href="../articles/model-evaluation.html">Model evaluation</a>
    </li>
    <li>
      <a href="../articles/splines.html">Splines</a>
    </li>
    <li>
      <a href="../articles/strata.html">Stratified baseline</a>
    </li>
    <li>
      <a href="../articles/tdcovar.html">Time-dependent covariates</a>
    </li>
    <li>
      <a href="../articles/tveffects.html">Time-varying effects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://github.com/adibender/pamm">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit a piece-wise exponential additive model</h1>
    </div>

    
    <p>Basically a wrapper around <code><a href='http://www.rdocumentation.org/packages/mgcv/topics/gam'>gam</a></code>. However, we set
<code>family=poisson()</code>, <code>offset=data$offset</code> and <code>method="REML"</code>
by default. The first two can not be overriden. The <code>method</code> argument
can be specified as usually, but defaults to <code>GCV.cp</code> in <code><a href='http://www.rdocumentation.org/packages/mgcv/topics/gam'>gam</a></code>.</p>
<p>Check if object is of class pamm</p>
    

    <pre class="usage"><span class='fu'>pamm</span>(<span class='no'>formula</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='fu'>list</span>(), <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"REML"</span>, <span class='no'>...</span>)

<span class='fu'><a href='is.pamm.html'>is.pamm</a></span>(<span class='no'>x</span>)

<span class='co'># S3 method for pamm</span>
<span class='fu'>print</span>(<span class='no'>x</span>, <span class='no'>...</span>)

<span class='co'># S3 method for pamm</span>
<span class='fu'>summary</span>(<span class='no'>object</span>, <span class='no'>...</span>)

<span class='co'># S3 method for pamm</span>
<span class='fu'>plot</span>(<span class='no'>x</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>A GAM formula, or a list of formulae (see <code>formula.gam</code> and also <code>gam.models</code>). 
These are exactly like the formula for a GLM except that smooth terms, <code>s</code>, <code>te</code>, <code>ti</code> 
and <code>t2</code>, can be added to the right hand side to specify that the linear predictor depends on smooth functions of predictors (or linear functionals of these).</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>A data frame or list containing the model response variable and 
covariates required by the formula. By default the variables are taken 
from <code>environment(formula)</code>: typically the environment from 
which <code>gam</code> is called.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>The smoothing parameter estimation method. <code>"GCV.Cp"</code> to use GCV for unknown scale parameter and
Mallows' Cp/UBRE/AIC for known scale. <code>"GACV.Cp"</code> is equivalent, but using GACV in place of GCV. <code>"REML"</code> 
for REML estimation, including of unknown scale, <code>"P-REML"</code> for REML estimation, but using a Pearson estimate 
of the scale. <code>"ML"</code> and <code>"P-ML"</code> are similar, but using maximum likelihood in place of REML. Beyond the 
exponential family <code>"REML"</code> is the default, and the only other option is <code>"ML"</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further arguments passed to <code><a href='http://www.rdocumentation.org/packages/mgcv/topics/gam'>gam</a></code>.</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>Any R object.</p></td>
    </tr>
    <tr>
      <th>object</th>
      <td><p>An object of class <code>pamm</code> as returned by <code>pamm</code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>If <code>fit=FALSE</code> the function returns a list <code>G</code> of items needed to
fit a GAM, but doesn't actually fit it.</p>
<p>Otherwise the function returns an object of class <code>"gam"</code> as described in <code>gamObject</code>.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>A generalized additive model (GAM) is a generalized linear model (GLM) in which the linear 
predictor is given by a user specified sum of smooth functions of the covariates plus a 
conventional parametric component of the linear predictor. A simple example is:
$$\log(E(y_i)) = \alpha + f_1(x_{1i})+f_2(x_{2i})$$
where the (independent) response variables \(y_i \sim {\rm Poi }\), and
\(f_1\) and \(f_2\) are smooth functions of covariates \(x_1\) and 
\(x_2\). The log is an example of a link function. Note that to be identifiable the model
requires constraints on the smooth functions. By default these are imposed automatically and require that the function sums to zero over the observed covariate values (the presence of a metric <code>by</code> variable is the only case which usually suppresses this).</p>
<p>If absolutely any smooth functions were allowed in model fitting then maximum likelihood 
estimation of such models would invariably result in complex overfitting estimates of 
\(f_1\)  and \(f_2\). For this reason the models are usually fit by 
penalized likelihood 
maximization, in which the model (negative log) likelihood is modified by the addition of 
a penalty for each smooth function, penalizing its `wiggliness'. To control the tradeoff 
between penalizing wiggliness and penalizing badness of fit each penalty is multiplied by 
an associated smoothing parameter: how to estimate these parameters, and 
how to practically represent the smooth functions are the main statistical questions 
introduced by moving from GLMs to GAMs.</p>
<p>The <code>mgcv</code> implementation of <code>gam</code> represents the smooth functions using 
penalized regression splines, and by default uses basis functions for these splines that 
are designed to be optimal, given the number basis functions used. The smooth terms can be 
functions of any number of covariates and the user has some control over how smoothness of 
the functions is measured.
    <code>gam</code> in <code>mgcv</code> solves the smoothing parameter estimation problem by using the 
Generalized Cross Validation (GCV) criterion
$$n D / (n - DoF)^2$$
 or an Un-Biased Risk Estimator (UBRE )criterion
$$D/n + 2 s DoF / n - s $$ 
where \(D\) is the deviance, \(n\) the number of data, \(s\)
the scale parameter and 
\(DoF\) the effective degrees of freedom of the model. Notice that UBRE is effectively
just AIC rescaled, but is only used when \(s\) is known.</p>
<p>Alternatives are GACV, or a Laplace approximation to REML. There
is some evidence that the latter may actually be the most effective choice. 
The main computational challenge solved 
by the <code>mgcv</code> package is to optimize the smoothness selection criteria efficiently and reliably. Various
alternative numerical methods are provided which can be set by argument <code>optimizer</code>.</p>
    <p>Broadly <code>gam</code> works by first constructing basis functions and one or more quadratic penalty 
coefficient matrices for each smooth term in the model formula, obtaining a model matrix for 
the strictly parametric part of the model formula, and combining these to obtain a 
complete model matrix (/design matrix) and a set of penalty matrices for the smooth terms. 
The linear identifiability constraints are also obtained at this point. The model is 
fit using <code>gam.fit</code>, <code>gam.fit3</code> or varaints, which are modifications 
of <code>glm.fit</code>. The GAM 
penalized likelihood maximization problem is solved by Penalized Iteratively 
Reweighted  Least Squares (P-IRLS) (see e.g. Wood 2000). 
Smoothing parameter selection is integrated in one of two ways. (i)
`Performance iteration' uses the fact that at each P-IRLS iteration a penalized 
weighted least squares problem is solved, and the smoothing parameters of that problem can 
estimated by GCV or UBRE. Eventually, in most cases, both model parameter estimates and smoothing 
parameter estimates converge. (ii) Alternatively the P-IRLS scheme is iterated to
convergence for each trial set of smoothing parameters, and GCV, UBRE or REML scores
are only evaluated on convergence - optimization is then `outer' to the P-IRLS
loop: in this case the P-IRLS iteration has to be differentiated, to
facilitate optimization, and <code>gam.fit3</code> or one of its variants is used in place of
<code>gam.fit</code>. The default is the second method, outer iteration.</p>
    <p>Several alternative basis-penalty types  are built in for representing model
smooths, but alternatives can easily be added (see <code>smooth.terms</code> 
for an overview and <code>smooth.construct</code> for how to add smooth classes). The choice of the basis dimension 
(<code>k</code> in the <code>s</code>, <code>te</code>, <code>ti</code> and <code>t2</code> terms) is something that should be considered carefully 
(the exact value is not critical, but it is important not to make it restrictively small, nor very large and 
computationally costly). The basis should 
be chosen to be larger than is believed to be necessary to approximate the smooth function concerned. 
The effective degrees of freedom for the smooth will then be controlled by the smoothing penalty on 
the term, and (usually) selected automatically (with an upper limit set by
<code>k-1</code> or occasionally <code>k</code>). Of course 
the <code>k</code> should not be made too large, or computation will be slow (or in
extreme cases there will be more 
coefficients to estimate than there are data).</p>
<p>Note that <code>gam</code> assumes a very inclusive definition of what counts as a GAM: 
basically any penalized GLM can be used: to this end <code>gam</code> allows the non smooth model 
components to be penalized via argument <code>paraPen</code> and allows the linear predictor to depend on 
general linear functionals of smooths, via the summation convention mechanism described in 
<code>linear.functional.terms</code>. <code>link{family.mgcv}</code> details what is available beyond GLMs 
and the exponential family.</p>     
<p>Details of the default underlying fitting methods are given in Wood (2011
and 2004). Some alternative methods are discussed in Wood (2000 and 2006).
    <code>gam()</code> is not a clone of Trevor Hastie's original (as supplied in S-PLUS or package gam). The major
differences are (i) that by default estimation of the
degree of smoothness of model terms is part of model fitting, (ii) a
Bayesian approach to variance estimation is employed that makes for easier
confidence interval calculation (with good coverage probabilities), (iii) that the model
can depend on any (bounded) linear functional of smooth terms, (iv) the parametric part of the model can be penalized, 
(v) simple random effects can be incorporated, and 
(vi) the facilities for incorporating smooths of more than one variable are
different: specifically there are no <code>lo</code> smooths, but instead (a) <code>s</code>
terms can have more than one argument, implying an isotropic smooth and (b) <code>te</code>, 
<code>ti</code> or <code>t2</code> smooths are
provided as an effective means for modelling smooth interactions of any
number of variables via scale invariant tensor product smooths. Splines on the sphere, Duchon splines 
and Gaussian Markov Random Fields are also available. (vii) Models beyond the exponential family are available. 
See gam from package <code>gam</code>, for GAMs via the original Hastie and Tibshirani approach.</p>
    
    <h2 class="hasAnchor" id="warnings-"><a class="anchor" href="#warnings-"></a>WARNINGS </h2>

    
    <p>The default basis dimensions used for smooth terms are essentially arbitrary, and 
it should be checked that they are not too small. See <code>choose.k</code> and
<code>gam.check</code>.</p>
<p>You must have more unique combinations of covariates than the model has total
parameters. (Total parameters is sum of basis dimensions plus sum of non-spline 
terms less the number of spline terms).</p>
<p>Automatic smoothing parameter selection is not likely to work well when 
fitting models to very few response data.</p>
<p>For data with many  zeroes clustered together in the covariate space it is quite easy to set up 
GAMs which suffer from identifiability problems, particularly when using Poisson or binomial
families. The problem is that with e.g. log or logit links, mean value zero corresponds to
an infinite range on the linear predictor scale.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Key References on this implementation:</p>
<p>Wood, S.N. (2011) Fast stable restricted maximum likelihood 
and marginal likelihood estimation of semiparametric generalized linear 
models. Journal of the Royal Statistical Society (B) 73(1):3-36</p>
<p>Wood, S.N. (2004) Stable and efficient multiple smoothing parameter estimation for
generalized additive models. J. Amer. Statist. Ass. 99:673-686. [Default
method for additive case by GCV (but no longer for generalized)]</p>
<p>Wood, S.N. (2003) Thin plate regression splines. J.R.Statist.Soc.B 65(1):95-114</p>
<p>Wood, S.N. (2006a) Low rank scale invariant tensor product smooths for
generalized additive mixed models. Biometrics 62(4):1025-1036</p>
<p>Wood S.N. (2006b) Generalized Additive Models: An Introduction with R. Chapman
and Hall/CRC Press.</p>
<p>Wood S.N., F. Scheipl and J.J. Faraway (2012) Straightforward intermediate rank tensor product smoothing
in mixed models. Statistical Computing.</p>
<p>Marra, G and S.N. Wood (2012) Coverage Properties of Confidence Intervals for Generalized Additive
Model Components. Scandinavian Journal of Statistics, 39(1), 53-74.</p>
    <p>Key Reference on GAMs and related models:</p>
<p>Hastie (1993) in Chambers and Hastie (1993) Statistical Models in S. Chapman
and Hall.</p>
<p>Hastie and Tibshirani (1990) Generalized Additive Models. Chapman and Hall.</p>
<p>Wahba (1990) Spline Models of Observational Data. SIAM</p>
<p>Wood, S.N. (2000)  Modelling and Smoothing Parameter Estimation
with Multiple Quadratic Penalties. J.R.Statist.Soc.B 62(2):413-428 [The original
mgcv paper, but no longer the default methods.]</p>
<p>Background References:</p>
<p>Green and Silverman (1994) Nonparametric Regression and Generalized  Linear Models. Chapman and Hall.</p>  
<p>Gu and Wahba (1991) Minimizing GCV/GML scores with multiple smoothing parameters via
the Newton method. SIAM J. Sci. Statist. Comput. 12:383-398</p>
<p>Gu (2002) Smoothing Spline ANOVA Models, Springer.</p>
<p>McCullagh and Nelder (1989) Generalized Linear Models 2nd ed. Chapman &amp; Hall.</p>
<p>O'Sullivan, Yandall and Raynor (1986) Automatic smoothing of regression
functions in generalized linear models.
J. Am. Statist.Ass. 81:96-103</p>
<p>Wood (2001) mgcv:GAMs and Generalized Ridge Regression for R. R News 1(2):20-25</p>   
<p>Wood and Augustin (2002) GAMs with integrated model selection using penalized regression splines and applications 
to environmental modelling. Ecological Modelling 157:157-177
    <a href='http://www.maths.bris.ac.uk/~sw15190/'>http://www.maths.bris.ac.uk/~sw15190/</a></p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code>mgcv-package</code>, <code>gamObject</code>, <code>gam.models</code>, <code>smooth.terms</code>,
<code>linear.functional.terms</code>, <code>s</code>,
<code>te</code> <code>predict.gam</code>,
<code>plot.gam</code>, <code>summary.gam</code>, <code>gam.side</code>,
<code>gam.selection</code>, <code>gam.control</code>
<code>gam.check</code>, <code>linear.functional.terms</code> <code>negbin</code>, <code>magic</code>,<code>vis.gam</code></p>
    

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#warnings-">WARNINGS </a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
          </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Andreas Bender, Fabian Scheipl.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
